# üóÇÔ∏è Makefile –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–º

.PHONY: help dev build prod deploy clean logs backup

# –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É
help:
	@echo "–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
	@echo "  dev       - –ó–∞–ø—É—Å–∫ —Å—Ä–µ–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏"
	@echo "  build     - –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
	@echo "  prod      - –ó–∞–ø—É—Å–∫ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ"
	@echo "  deploy    - –ü–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º"
	@echo "  backup    - –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ –ë–î"
	@echo "  logs      - –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
	@echo "  clean     - –û—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏ –æ–±—Ä–∞–∑–æ–≤"
	@echo "  migrate   - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î"

# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
dev:
	@echo "üîß –ó–∞–ø—É—Å–∫ —Å—Ä–µ–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏..."
	./scripts/dev-start.sh
	npm run dev

# –°–±–æ—Ä–∫–∞
build:
	@echo "üèóÔ∏è –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
	npm run build

# –ü—Ä–æ–¥–∞–∫—à–µ–Ω
prod:
	@echo "üöÄ –ó–∞–ø—É—Å–∫ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ..."
	docker-compose up -d

# –î–µ–ø–ª–æ–π
deploy:
	@echo "üöÄ –î–µ–ø–ª–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
	./scripts/deploy.sh

# –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è
backup:
	@echo "üíæ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏..."
	./scripts/db-backup.sh

# –õ–æ–≥–∏
logs:
	@echo "üìã –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤..."
	docker-compose logs -f app

# –û—á–∏—Å—Ç–∫–∞
clean:
	@echo "üßπ –û—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏ –æ–±—Ä–∞–∑–æ–≤..."
	docker-compose down
	docker system prune -f
	docker volume prune -f

# –ú–∏–≥—Ä–∞—Ü–∏–∏
migrate:
	@echo "üìä –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î..."
	docker-compose exec app npx prisma migrate deploy